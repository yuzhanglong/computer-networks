---
title: 应用层
slug: /
---

## 复习题

1.列出五种非专用的因特网应用以及他们所使用的应用层协议。

| 因特网应用   | 协议       |
| ------------ | ---------- |
| web          | HTTP       |
| 文件传输     | FTP        |
| 电子邮件     | SMTP       |
| 目录服务     | DNS        |
| 文件分发     | BitTorrent |
| 远程终端访问 | Telnet     |

2.网络体系结构与应用程序体系结构之间有什么区别?

**网络体系结构**是指将通信过程**组织成层**（例如，五层互联网架构），从应用程序研发者的角度来看，网络体系结构是固定的，并为应用程序提供了特定的服务集合。

**应用程序体系结构**是由应用程序开发人员设计的，规定了如何在各种端系统上组织该应用程序。（例如，客户端服务器或P2P）



3.对两进程之间的通信会话而言，哪个进程是客户，哪个进程是服务器?

发起通信的是**客户**（Client）,  等待被连接的进程是**服务器**（Server）



4.对一个P2P文件共享应用，你同意“一个通信会话不存在客户端和服务器端的概念”的说法吗?为什么?

**不同意**。在P2P文件共享应用程序中，接收文件的一方可以看成客户端，发送文件的一方可以看成服务器。



5.运行在一台主机上的一个进程，使用什么信息来标识运行在另一台主机上的进程?

目标主机的I**P地址**和目标进程中套接字(Socket）的**端口号**。



6.假定你想尽快地处理从远程客户到服务器的事务，你将使用UDP还是TCP? 为什么?

使用**UDP**，理由如下:

UDP**没有握手进程**，提供了一种不可靠的数据传输服务。使用UDP，事务可以在**一个往返时间**（RTT）内完成——客户端将事务请求发送到UDP套接字，服务器将响应发送回客户端的UDP套接字。对于TCP，至少需要两个RTT—一个用于设置TCP连接，另一个用于客户端发送请求，服务器发送回复。

UDP**没有包括拥塞控制机制**，所以发送端可以以任何速率向其下面的层（网络层）注入数据。

- 附：两者的区别：

|              | UDP                                        | TCP                                    |
| :----------- | :----------------------------------------- | -------------------------------------- |
| 是否连接     | 无连接                                     | 面向连接                               |
| 是否可靠     | 不可靠传输，不使用流量控制和拥塞控制       | 可靠传输，使用流量控制和拥塞控制       |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信                       |
| 传输方式     | 面向报文                                   | 面向字节流                             |
| 首部开销     | 首部开销小，仅8字节                        | 首部最小20字节，最大60字节             |
| 适用场景     | 适用于实时应用（IP电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输 |



7.你能设想一个既要求无数据丢失又高度时间敏感的应用程序吗?

一个这样的例子是**远程文字处理**，例如使用googleDocs。



8.列出一个运输协议能够提供的4种宽泛类型的服务。对于每种服务类型，指出是UDP还是TCP (或这两种协议)提供这样的服务?

|              | UDP                                  | TCP                                                        |
| :----------- | :----------------------------------- | ---------------------------------------------------------- |
| 可靠数据传输 | 不可靠传输，不使用流量控制和拥塞控制 | 可靠传输，使用流量控制和拥塞控制                           |
| 吞吐量       | 不提供                               | 不提供                                                     |
| 定时         | 不提供                               | 不提供                                                     |
| 安全性       | 不提供                               | 不提供（但TCP能用SSL来强化，以提供进程到进程的安全性服务） |



9.前面讲过TCP能用SSL来强化，以提供进程到进程的安全性服务，包括加密。SSL运行在运输层还是应用层?如果某应用程序研制者想要用SSL来强化UDP,该研制者应当做些什么工作?

SSL在**应用层**运行。SSL套接字从应用层获取未加密的数据，对其进行加密，然后将其传递给TCP套接字。如果应用程序开发人员希望用SSL增强TCP，他需要在**该应用程序的客户端和服务器端包括SSL代码**（利用现有的、高度优化的库、类）



10.握手协议的作用是什么?



11.为什么HTTP、FTP、 SMTP及POP3都运行在TCP,而不是UDP上?

与这些协议相关联的应用程序要求以正确的顺序接收所有应用程序数据，并且没有间隔。TCP提供此服务，而UDP不提供此服务。



12.考虑个电子商务网站需要保留每个客户的购买记录。描述如何使用cookie来完成该功能?

当用户第一次访问站点时，服务器会创建一个**唯一的标识号**，在其后端数据库中**创建一个条目**，并将此标识号作为cookie编号。此cookie编号存储在用户的主机上，由浏览器进行管理。在随后的每次访问（和购买）过程中，浏览器将发送cookie号码返回站点。因此，网站知道该用户何时（更准确地说，此浏览器）正在访问站点。



13.描述Web缓存器是如何减少接收被请求的对象的时延的。Web缓存器将减少一个用户请求的所有对象或只是其中的某些对象的时延吗?为什么?



14.Telnet 到一台Web服务器并发送一个多行的请求报文。在该请求报文中包含if-modifed-since首部行，迫使响应报文中出现“304 Not Modifed"状态代码。

默认情况下，Telnet在Windows 7中不可用。要使其可用，请转到控制面板，程序和功能，打开或关闭Windows功能。

具体过程略去。



15. 为什么说FTP在“带外”（out of band）发送控制信息?

FTP使用两个并行的TCP连接，一个连接用于发送控制信息（例如传输文件的请求），另一个连接

用来传输文件。因为控制信息不是通过与文件发送相同的连接发送的，所以FTP在“带外”（out of band）发送控制信息。



16.假定Alie使用一个基于 Web的电子邮件账户(例如Hotmail或gmail)向Bob发报文，而Bob使用POP3从他的邮件服务器访问自己的邮件。讨论是怎样从Alie主机到Bob主机得到该报文的。要列出在两台主机间移动该报文时所使用的各种应用层协议。

- Alice调用他的邮件代理程序并提供Bob的邮件地址，撰写报文，然后指示用户代理发送该报文。

- Alice的用户代理把报文发送给他的邮件服务器，在那里报文被放在报文队列中。
- 运行在Alice的邮件服务器上的SMTP客户端发现了报文队列的这个报文，它就创建一个到运行在Bob的邮件服务器上的SMTP服务器的TCP连接。
- 在经历一些初始SMTP握手之后，SMTP客户端通过TCP连接发送Alice的报文。
- 在Bob的邮件服务器上，SMTP的服务器端接收该报文，Bob的邮件服务器然后将该报文放入Bob的邮箱中。
- 在Bob方便的时候，他调用用户代理阅读报文。

17.将你最近收到的报文首部打印出来。其中有多少首部行?分析该报文的首部行中的每-行。

```
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
// 它决定了对于未来的一个请求头，应该用一个缓存的回复(response)还是向源服务器请求一个新的回复。它被服务器用来表明在 content negotiation algorithm（内容协商算法）中选择一个资源代表的时候应该使用哪些头部信息（headers）.

Access-Control-Allow-Origin: http://oj.yuzzl.top

// 格式：Access-Control-Allow-Origin: <origin> | *
// 其中，origin 参数的值指定了允许访问该资源的外域 URI。对于不需要携带身份凭证的请求，服务器可以指定该字段的值为通配符，表示允许来自所有域的请求。


Access-Control-Allow-Credentials: true
// Access-Control-Allow-Credentials 头指定了当浏览器的credentials设置为true时是否允许浏览器读取response的内容。当用在对preflight预检测请求的响应中时，它指定了实际的请求是否可以使用credentials。请注意：简单 GET 请求不会被预检；如果对此类请求的响应中不包含该字段，这个响应将被忽略掉，并且浏览器也不会将相应内容返回给网页。


Content-Type: application/json
// 指示服务器文档的 MIME 类型。帮助用户代理（浏览器）去处理接收到的数据。(PS:可搜索MIME关键词了解相关内容)

Transfer-Encoding: chunked
// 消息首部指明了将 entity 安全传递给用户所采用的编码形式。
这里的值为: chunked。数据以一系列分块的形式进行发送。 Content-Length 首部在这种情况下不被发送。在每一个分块的开头需要添加当前分块的长度，以十六进制的形式表示，后面紧跟着 '\r\n' ，之后是分块本身，后面也是'\r\n' 。终止块是一个常规的分块，不同之处在于其长度为0。终止块后面是一个挂载（trailer），由一系列（或者为空）的实体消息首部构成。

Date: Sun, 04 Oct 2020 11:36:59 GMT
// 是一个通用首部，其中包含了报文创建的日期和时间。

Keep-Alive: timeout=60
// 是一个通用消息头，允许消息发送者暗示连接的状态，还可以用来设置超时时长和最大请求数。

Connection: keep-alive
// 决定当前的事务完成后，是否会关闭网络连接。如果该值是“keep-alive”，网络连接就是持久的，不会关闭，使得对同一个服务器的请求可以继续在该连接上完成。
```



I8.从用户的观点看，POP3 协议中下载并删除模式和下载并保留模式有什么区别吗?

下载并删除模式: 他们可能希望从许多不同的机器（办公PC、家庭PC等）访问消息。如果某个设备收取过邮件，那么其他的设备在接下来将无法收取邮件。

下载并保留模式：用户检索消息后不会删除消息。这也可能不方便，因为每次用户从新机器检索存储的消息时，所有未删除的消息都将被传输到新机器上（包括非常旧的消息）。



19.一个机构的Web服务器和邮件服务器可以有完全相同的主机名别名(例如，foo. com)吗? 包含邮件服务器主机名的RR有什么样的类型?

可以。DNS资源记录中的Type为MX时，Value是个别名为Name的邮件服务器的规范主机名。而 A 记录指向网页服务器。

实际处理的时候如果 MX 记录为空，会回落到 A 记录的地址。

```shell
host -t a baidu.com

baidu.com has address 220.181.38.148
baidu.com has address 39.156.69.79

host -t mx baidu.com

baidu.com mail is handled by 20 mx1.baidu.com.
baidu.com mail is handled by 15 mx.n.shifen.com.
baidu.com mail is handled by 10 mx.maillb.baidu.com.
baidu.com mail is handled by 20 mx50.baidu.com.
baidu.com mail is handled by 20 jpmx.baidu.com.
```

类型列举如下：

| Type  | Name   | Value                                               | 示例                                                         | 描述                                       |
| ----- | ------ | --------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------ |
| A     | 主机名 | 对应的IP                                            | （oj.yuzzl.top, 182.254.197.28, A）                          | 提供了标准的主机名到IP地址的映射           |
| NS    | 域     | 知道如何获得该域中主机IP地址的权威DNS服务器的主机名 | （yuzzl.top， f1g1ns1.dnspod.net， NS）                      | 用户沿着查询链来路由DNS查询                |
| CNAME | 主机名 | 别名为Name的主机对应的规范主机名                    | （cdn.yuzzl.top，cdn-yuzzl-top-idvctpr.qiniudns.com.， CNAME） | 向查询的主机提供一个主机名对应的规范主机名 |
| MX    | 主机名 | 别名为Name的邮件服务器的规范主机名                  | （yuzzl.top, mail.yuzzl.top, MX）                            | 允许邮件服务器主机名具有简单的别名         |





20.仔细检查收到的电子邮件，查找由使用. edu电子邮件地址的用户发送的报文首部。从其首部，能够确定发送该报文的主机的IP地址吗?对于由gmail账号发送的报文做相同的事。

你应该能够看到一个用户的.edu电子邮件发件人的IP地址。但是如果用户使用gmail，你将无法看到发件人的IP地址。



21.在Bitorrent中，假定Alice向Bob提供个30秒间隔的文件块吞吐量。Bob 将必须进行回报，在相同的间隔中向Alice提供文件块吗?为什么?

没有必要Bob也将块提供给Alice。BitTorrent使用了一种机灵的兑换算法，其基本想法是Alice根据当前能够以最高速率向她提供数据的邻居，给出其优先权。特别是，Alice对于她的每个邻居都持续的测量接收到比特的速率，并确定以最高速率流入的4个邻居，每过十秒，她重新计算该速率并可能修改这四个对等方的集合。这四个对等方被称为疏通（unchoked）。每过30s，她也要随机选择另外一个邻居并向其发送块，如果Bob向Alice发送的速率足够高，Bob接下来也可能成为Alice的上载者，他们将对方放入其前四位列表中并继续和对方交换。总而言之，题目的情况有可能发生，但不是必须的条件。



22.考虑一个新对等方Alice加人BifTorent而不拥有任何文件块。没有任何块，因此她没有任何东西可上载，她无法成为任何其他对等方的前4位上载者。那么Alice将怎样得到她的第一个文件块呢?

追踪器（tracker）会随机地从参与对等方的集合中选择**对等方的一个子集**，然后将这些对等方的IP地址发给Alice。Alice持有对等方的这张列表，试图和该列表上的所有对等方**建立并行的TCP连接**。



23.覆盖网络是什么?它包括路由器吗?在覆盖网络中边是什么?





24.考虑一个具有网状覆盖网络拓扑的DHT (即每个对等方跟踪系统中的所有对等方)。这样设计的优点和缺点各是什么?环形DHT ( 无捷径)的优点和缺点各是什么?





25.列出至少4个不同的应用，它们本质上适合P2P体系结构。(提示:文件分布和即时讯息是两个这样的应用。)

- 文件分发
- 即时消息
- 视频流媒体
- 分布式计算



26.UDP服务器只需要一个套接字，而TCP服务器需要两个套接字，为什么？如果TCP服务器支持n个并行连接，每条连接来自不同的客户主机，那么TCP服务器将需要多少个套接字？





27.对于2.7节所描述的运行在TCP之上的客户--服务器应用程序，服务器程序为什么必须先于客户程序运行？对于运行在UDP之上的客户--服务器应用程序，客户程序为什么可以先于服务器程序运行？

